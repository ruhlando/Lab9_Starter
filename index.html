<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lab 9 â€“ Console & Error Handling</title>
  <style>
    button { margin: 3px; }
    button:hover { cursor: pointer; }
    #first-num, #second-num { width: 60px; }
    output {
      border: 1px solid gray;
      display: block;
      height: 18px;
      margin-top: 5px;
      padding: 5px;
      width: 240px;
    }
    main { width: 800px; }
    #error-btns {
      column-gap: 5px;
      display: flex;
      flex-wrap: wrap;
      margin-top: 30px;
      row-gap: 5px;
    }
    #error-btns > * {
      padding: 8px 2px;
      width: 122px;
    }
    #user-profile {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <main>
    <form>
      <fieldset>
        <legend>Error Calculator</legend>
        <input id="first-num" />
        <select id="operator">
          <option>+</option><option>-</option><option>*</option><option>/</option>
        </select>
        <input id="second-num" />
        <button id="calculate">Calculate</button>
        <br/>
        <output></output>
      </fieldset>
    </form>

    <section id="error-btns">
      <button id="btn-log">Console Log</button>
      <button id="btn-error">Console Error</button>
      <button id="btn-count">Console Count</button>
      <button id="btn-warn">Console Warn</button>
      <button id="btn-assert">Console Assert</button>
      <button id="btn-clear">Console Clear</button>
      <button id="btn-dir">Console Dir</button>
      <button id="btn-dirxml">Console Dirxml</button>
      <button id="btn-group-start">Console Group Start</button>
      <button id="btn-group-end">Console Group End</button>
      <button id="btn-table">Console Table</button>
      <button id="btn-timer-start">Start Timer</button>
      <button id="btn-timer-end">End Timer</button>
      <button id="btn-trace">Console Trace</button>
      <button id="btn-custom-error">Custom Error</button>
      <button id="btn-global-error">Trigger a Global Error</button>
      <button id="btn-extended-error">Extended Error</button>
    </section>

    <!-- Uncomment to simulate profile existing -->
    <!--
    <div id="user-profile">
      <h2>User Profile</h2>
      <p>Name: Jane Doe</p>
      <p>Role: Student</p>
    </div>
    -->
  </main>

  <script>
    // Calculator with try/catch/finally
    document.getElementById('calculate').addEventListener('click', e => {
      e.preventDefault();
      const out = document.querySelector('output');
      const a = Number(document.getElementById('first-num').value);
      const b = Number(document.getElementById('second-num').value);
      const op = document.getElementById('operator').value;

      try {
        if (isNaN(a) || isNaN(b)) {
          throw new TypeError('Both inputs must be valid numbers');
        }
        const result = eval(`${a} ${op} ${b}`);
        out.textContent = result;
      } catch (err) {
        console.error('Calculation error:', err);
        out.textContent = 'Error!';
      } finally {
        console.log('Calculation attempt finished');
      }
    });

    // Step 2: Console API demos
    const demos = {
      log:         () => console.log('Hello from %s demo!', 'console.log'),
      error:       () => console.error('This is a console.error message'),
      count:       () => console.count('DemoCounter'),
      warn:        () => console.warn('Warning: something suspicious happened'),
      assert:      () => console.assert(1 + 1 === 3, 'Assert failed: 1+1!==3'),
      clear:       () => console.clear(),
      dir:         () => console.dir(document.body),
      dirxml:      () => console.dirxml(document.body),
      groupStart:  () => {
                       console.group('Demo Group');
                       console.log('Inside group');
                     },
      groupEnd:    () => console.groupEnd(),
      table:       () => console.table([
                       { name: 'Alice', score: 42 },
                       { name: 'Bob',   score: 37 },
                     ]),
      timerStart:  () => console.time('MyTimer'),
      timerEnd:    () => console.timeEnd('MyTimer'),
      trace:       () => {
                       function x() { y(); }
                       function y() { z(); }
                       function z() { console.trace('Trace here'); }
                       x();
                     },
      globalError: () => {
                       missingFunction();
                     }
    };

    Object.entries(demos).forEach(([key, fn]) => {
      const btn = document.getElementById('btn-' + key);
      if (btn) btn.onclick = fn;
    });

    // Step 3: try/catch/finally + throw demo
    document.getElementById('btn-custom-error').onclick = () => {
      try {
        const profile = document.getElementById('user-profile');
        if (!profile) {
          throw new ReferenceError('Element #user-profile is required but missing.');
        }
        console.log('Profile element found:', profile);
      } catch (err) {
        console.error('Custom error caught:', err);
      } finally {
        console.log('Custom error demo complete (finally always runs).');
      }
    };

    // Step 4: Extended Custom Error Demo
    class ValidationError extends Error {
      constructor(message, code) {
        super(message);
        this.name = 'ValidationError';
        this.code = code;
      }
    }

    document.getElementById('btn-extended-error').onclick = () => {
      try {
        const age = prompt('Enter your age:');
        const numAge = Number(age);
        if (isNaN(numAge)) {
          throw new ValidationError('Age must be a number', 'ERR_NOT_NUMBER');
        }
        if (numAge < 18) {
          throw new ValidationError('You must be at least 18 years old', 'ERR_UNDERAGE');
        }
        console.log('Age validated:', numAge);
      } catch (err) {
        if (err instanceof ValidationError) {
          console.error(`%c${err.name} [${err.code}]: ${err.message}`, 'color: red;');
        } else {
          console.error('Unexpected error:', err);
        }
      } finally {
        console.log('Extended error demo done.');
      }
    };
  </script>
</body>
</html>